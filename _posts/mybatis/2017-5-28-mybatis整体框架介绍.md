---
layout: post
title: mybatis整体框架
tags: mybatis 框架
categories: mybatis
---    

[toc]  

#### 1、mybatis框架   

<img src="https://zy123a.github.io/zy-blog/images/mybatis/mybatis框架.png" width="600" height="500" alt="image"/>

##### 1.1、接口层--与数据库交互的api  

mybatis提供了两种与数据库交互的方式：  
  
* 传统的mybatis提供的api；   
  
* 使用mapper接口；  

###### 1.1.1、使用mybatis提供的传统api方法   

传统的api方式即传入statementId和param利用SqlSession提供的select/update/delete/insert等方法来与数据库进行交互；  
 
 <img src="https://zy123a.github.io/zy-blog/images/mybatis/传统的mybatis工作方式.png" width="600" height="300" alt="image"/>    
  
 具体实例如下所示：  
**映射器接口**
````java 
public interface EnvironmentDao {
     public int updateEnv(@Param("ip") String ip,@Param("id") int id);
     public EnvironmentDo selectById(@Param("id") int id);
 }   
````   

**mapper.xml**      
```dtd
<?xml version="1.0" encoding="UTF-8" ?>
<!--suppress SqlDialectInspection -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.meituan.service.mobile.meilv.dao.EnvironmentDao">
    <update id="updateEnv" >
        UPDATE test_env
        SET ip = #{ip}
        WHERE id = #{id}
    </update>
    <select id="selectById" resultType="com.meituan.service.mobile.meilv.dao.bean.EnvironmentDo">
        SELECT id ,ip,name FROM test_env WHERE id=#{id}
    </select>
</mapper>
```  

**传统mybatis的api使用**     
```
  sqlSession = MySqlSessionFactoryUtils.openSqlSession();
  Map<String,Object> map = new HashMap();
  map.put("ip", currentEnv.getTicketServer().substring(7));
  map.put("id", new Integer(Type.Rhone_callback.getId()));
  sqlSession.update("com.meituan.service.mobile.meilv.dao.EnvironmentDao.updateEnv", map);
```   

###### 1.1.2、使用mapper接口   

mybatis将Mapper.xml中映射器配置抽象为一个mapper接口，接口中的方法与xxMapper.class
接口中的方法一一对应。mapper.xml中insert，select，update，delete节点的id为xxMapper.class中
的方法名，parameterType为接口中的参数，resultType为接口中的返回类型；   

<img src="https://zy123a.github.io/zy-blog/images/mybatis/mapper.png" width="600" height="300" alt="image"/>       
    
用户使用sqlSession.getMapper()方法获取一个Mapper实例，sqlSession.getMapper的底层实现是mybatis利用jdk动态代理为
mapper生成一个代理对象返回给用户；当用用户调用一个mapper方法时，mybatis会根据这个方法的方法名和
参数来确定statementId和param，底层还是使用sqSession.select(statementId,param)来实现；
具体实现如下：   
```
EnvironmentDao environmentDao = sqlSession.getMapper(EnvironmentDao.class);
environmentDao.updateEnv(currentEnv.getTicketServer().substring(7), Type.Rhone_callback.getId());
```

